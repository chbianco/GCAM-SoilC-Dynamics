else if(grepl('shrub', land)){return('Shrubland')}
else if(grepl('tundra',land)){return('Tundra')}
else if(grepl('pasture', land)){return('Pasture')}
else if(grepl('urban', land)){return('Urbanland')}
else if(grepl('irrigated', land) | grepl('rainfed', land)){return('Cropland')}
else if(grepl('otherarableland', land) ){return('Cropland')}
else{return(NA)}
}
sapply(filtered_transitions$to, simple_land) -> to_Land_Use
sapply(filtered_transitions$from, simple_land) -> from_Land_Use
mutate(filtered_transitions, to = to_Land_Use) %>%
mutate(from = from_Land_Use)
to_Land_Use
library(dplyr)
#Load the transition data into R
all_transitions <- read.csv(file = 'Data/transitions_combined_GCAM.csv')
all_transitions %>%
filter(sqkm_change != 0) -> filtered_transitions
simple_land <- function(land){
if(grepl('forest', land)){return('Forest')}
else if(grepl('grassland', land)){return('Grassland')}
else if(grepl('rockicedesert', land)){return('RockIceDesert')}
else if(grepl('shrub', land)){return('Shrubland')}
else if(grepl('tundra',land)){return('Tundra')}
else if(grepl('pasture', land)){return('Pasture')}
else if(grepl('urban', land)){return('Urbanland')}
else if(grepl('irrigated', land) | grepl('rainfed', land)){return('Cropland')}
else if(grepl('otherarableland', land) ){return('Cropland')}
else{return(NA)}
}
sapply(filtered_transitions$to, simple_land) -> to_Land_Use
sapply(filtered_transitions$from, simple_land) -> from_Land_Use
mutate(filtered_transitions, to = to_Land_Use) %>%
mutate(from = from_Land_Use)
mutate(filtered_transitions, to = to_Land_Use) %>%
mutate(from = from_Land_Use)  -> transitions
transitions
filtered_transitions %>%
mutate(to = to_Land_Use) %>%
mutate(from = from_Land_Use) %>%
mutate(change = c(to, from)) -> transitions
filtered_transitions %>%
mutate(to = to_Land_Use) %>%
mutate(from = from_Land_Use) %>%
mutate(change = c(to_Land_Use, from_Land_Use)) -> transitions
filtered_transitions %>%
mutate(to = to_Land_Use) %>%
mutate(from = from_Land_Use) %>%
mutate(change = paste(to, from)) -> transitions
transitions
filtered_transitions %>%
mutate(to = to_Land_Use) %>%
mutate(from = from_Land_Use) %>%
mutate(change = paste(to, from, sep = '')) -> transitions
transitions
filtered_transitions %>%
mutate(to = to_Land_Use) %>%
mutate(from = from_Land_Use) %>%
mutate(change = paste(to, from, sep = '')) %>%
group_by(change) %>%
summarize(sqkm_change, sum)-> transitions
filtered_transitions %>%
mutate(to = to_Land_Use) %>%
mutate(from = from_Land_Use) %>%
mutate(change = paste(to, from, sep = '')) %>%
group_by(change) %>%
summarize(sum(sqkm_change))-> transitions
transitions
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change)) %>%
arrange(`sum(sqkm_change)`)
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change)) %>%
arrange('sum(sqkm_change)')
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change))
transitions %>%
group_by(change)
filtered_transitions %>%
mutate(to = to_Land_Use) %>%
mutate(from = from_Land_Use) %>%
mutate(change = paste(to, from, sep = '')) -> transitions
transitions %>%
group_by(change)
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change))
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change)) %>%
arrange(`sum(sqkm_change)`)
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change)) %>%
arrange(desc(`sum(sqkm_change)`))
transitions
unique(transitions$metric_id)
unique(transitions$sce)
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change)) %>%
arrange(desc(`sum(sqkm_change)`))
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change)) %>%
arrange(desc(`sum(sqkm_change)`)) %>%
rename(total_skqm_change) -> total_transitions
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change)) %>%
arrange(desc(`sum(sqkm_change)`)) %>%
rename(total_skqm_change = `sum(sqkm_change)`) -> total_transitions
total_transitions
source("C:/Users/bian240/OneDrive - PNNL/Desktop/Initial Project Code/GCAM-SoilC-Dynamics/Old r exercises/Initial_SoilC_Graphs.R")
ggplot(data = total_transitions, aes(x=change, y=total_skqm_change)) +
geom_bar(stat='identity')
View(transitions)
transitions %>%
group_by(region_id, change)
transitions %>%
group_by(region_id, change) %>%
summarize(sum(sqkm_change))
ggplot(data = total_transitions, aes(x=change, y=total_skqm_change)) +
geom_bar(stat='identity') +
facet_wrap(~region_id)
transitions %>%
group_by(region_id, change) %>%
summarize(sum(sqkm_change)) %>%
arrange(desc(`sum(sqkm_change)`)) %>%
rename(total_skqm_change = `sum(sqkm_change)`) -> total_transitions
total_transitions
transitions %>%
group_by(region_id, change) %>%
summarize((region_id)) %>%
arrange(asc(`sum(sqkm_change)`)) %>%
rename(total_skqm_change = `sum(sqkm_change)`) -> total_transitions
transitions %>%
group_by(region_id, change) %>%
summarize(sum(sqkm_change)) %>%
arrange((`sum(sqkm_change)`)) %>%
rename(total_skqm_change = `sum(sqkm_change)`) -> total_transitions
total_transitions
View(transitions)
transitions %>%
group_by(region_id, change) %>%
summarize(sum(sqkm_change)) %>%
arrange((region_id)) %>%
rename(total_skqm_change = `sum(sqkm_change)`) -> total_transitions
View(transitions)
total_transitions
ggplot(data = total_transitions, aes(x=change, y=total_skqm_change)) +
geom_bar(stat='identity') +
facet_wrap(~region_id)
transitions %>%
group_by(metric_id, change) %>%
summarize(sum(sqkm_change)) %>%
arrange((region_id)) %>%
rename(total_skqm_change = `sum(sqkm_change)`)
transitions %>%
group_by(metric_id, change) %>%
summarize(sum(sqkm_change)) %>%
arrange((metric_id)) %>%
rename(total_skqm_change = `sum(sqkm_change)`) -> total_transitions_glu
total_transitions_glu
ggplot(data = transitions, aes(x = total_skqm_change, y = change)) +
geom_bar(stat='identity')
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change)) %>%
arrange((region_id)) %>%
rename(total_skqm_change = `sum(sqkm_change)`) -> total_transitions
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change)) %>%
rename(total_skqm_change = `sum(sqkm_change)`) %>%
arrange(desc(region_id))-> total_transitions
transitions %>%
group_by(change) %>%
summarize(sum(sqkm_change)) %>%
rename(total_skqm_change = `sum(sqkm_change)`) %>%
arrange(desc(total_skqm_change))-> total_transitions
total_transitions
ggplot(data = total_transitions, aes(x = total_skqm_change, y = change)) +
geom_bar(stat='identity')
source("C:/Users/bian240/OneDrive - PNNL/Desktop/Initial Project Code/GCAM-SoilC-Dynamics/Track_Transitions.R")
library(ggplot2)
ggplot(data = total_transitions_gcam32, aes(x=total_skqm_change, y=change)) +
geom_bar(stat='identity') +
facet_wrap(~region_id)
ggplot(data = total_transitions, aes(x = total_skqm_change, y = change)) +
geom_bar(stat='identity')
ggplot(data = total_transitions_gcam32, aes(x=total_skqm_change, y=change)) +
geom_bar(stat='identity') +
facet_wrap(~region_id)
packages.install('metafor')
install.packages("metafor")
source("C:/Users/bian240/OneDrive - PNNL/Desktop/Initial Project Code/GCAM-SoilC-Dynamics/Meta_Analysis.R")
View(PostKwon_Comparison)
PostKwon_Comparison %>%
group_by(GCAM_region_ID) %>%
summarize(mean_control = mean(Exp_Rate))
PostKwon_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_Rate))
PostKwon_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_Rate), sd_control= sd(Exp_Rate), n_control = (count(Exp_Rate)))
PostKwon_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_Rate), sd_control= sd(Exp_Rate), n_control = (n(Exp_Rate)))
PostKwon_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_Rate), sd_control= sd(Exp_Rate), n_control = (n()))
PostKwon_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_Rate), sd_control= sd(Exp_Rate), n_control = n(),
mean_GCAM = mean(GCAM_Rate), sd_GCAM = sd(GCAM_Rate), n_GCAM = n()
)
PostKwon_effect_sizes <-
escalc('SMD',
m1i = mean_control, n1i = n_control, sd1i = sd_control,
m2i = mean_GCAM, n2i = n_GCAM, sd2i = sd_GCAM,
data = PostKwon_MA_data
)
PostKwon_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_Rate), sd_control= sd(Exp_Rate), n_control = n(),
mean_GCAM = mean(GCAM_Rate), sd_GCAM = sd(GCAM_Rate), n_GCAM = n()
) -> PostKwon_MA_data
#Now, we can use escalc to get the standardized mean difference
PostKwon_effect_sizes <-
escalc('SMD',
m1i = mean_control, n1i = n_control, sd1i = sd_control,
m2i = mean_GCAM, n2i = n_GCAM, sd2i = sd_GCAM,
data = PostKwon_MA_data
)
View(PostKwon_effect_sizes)
PostKwon_fixed_effect_results <- rma(yi, vi, method = 'FE',
slab = GLU_code,
data = PostKwon_effect_sizes)
PostKwon_fixed_effect_results
#Forest plot for Post & Kwon
forest(
PostKwon_effect_sizes$yi, PostKwon_effect_sizes$vi,
annotate = FALSE,
slab = PostKwon_fixed_effect_results$slab,
xlab = 'ln(Response Ratio)',
#Below sets the size of study labels, shape of bars, and size of x labels
cex = .8, pch = 15, cex.lab = 1
)
#Forest plot for Post & Kwon
forest(
PostKwon_effect_sizes$yi, PostKwon_effect_sizes$vi,
annotate = FALSE,
slab = PostKwon_fixed_effect_results$slab,
xlab = 'ln(Response Ratio)',
#Below sets the size of study labels, shape of bars, and size of x labels
cex = .8, pch = 15, cex.lab = 1
)
#Adding the summary effect size
addpoly(
PostKwon_fixed_effect_results,
col = 'orange', cx = 1, annotate = TURE, mlab = 'Summary'
)
#Forest plot for Post & Kwon
forest(
PostKwon_effect_sizes$yi, PostKwon_effect_sizes$vi,
annotate = FALSE,
slab = PostKwon_fixed_effect_results$slab,
xlab = 'ln(Response Ratio)',
#Below sets the size of study labels, shape of bars, and size of x labels
cex = .8, pch = 15, cex.lab = 1
)
#Adding the summary effect size
addpoly(
PostKwon_fixed_effect_results,
col = 'orange', cx = 1, annotate = TRUE, mlab = 'Summary'
)
#Forest plot for Post & Kwon
forest(
PostKwon_effect_sizes$yi, PostKwon_effect_sizes$vi,
annotate = FALSE,
slab = PostKwon_fixed_effect_results$slab,
xlab = 'ln(Response Ratio)',
#Below sets the size of study labels, shape of bars, and size of x labels
cex = .8, pch = 15, cex.lab = 1
)
#Adding the summary effect size
addpoly(
PostKwon_fixed_effect_results,
col = 'orange', cex = 1, annotate = TRUE, mlab = 'Summary'
)
#Adding the summary effect size
addpoly(
PostKwon_fixed_effect_results,
col = 'orange', cex = 1, annotate = TRUE, mlab = 'Summary'
)
source("C:/Users/bian240/OneDrive - PNNL/Desktop/Initial Project Code/GCAM-SoilC-Dynamics/Wei_Analysis.R")
#Plot the two k vals against each other with a 1:1 line as well
ggplot(data = Rate_Comparison, aes(x = Exp_k, y = GCAM_k)) +
geom_point(aes(shape = Final_Land_Use, color = Initial_Land_Use), size = 2) +
scale_shape_manual(values = c(4, 8, 16, 17)) +
scale_shape(solid = TRUE) +
geom_abline() +
xlab('Experimental k (1/y)') + ylab('GCAM Derived k (1/y)') +
theme_light() +
xlim(-.15, .35) + ylim(-.15, .35)  +
labs(title = 'SOC rate comparison during land use transition', color =  'Initial Land Use', shape = 'Final Land Use')
ggplot() +
geom_histogram(aes(x = Rate_Comparison$Exp_k,fill ='Experimental k'), alpha = 0.5) +
geom_histogram(aes(x = Rate_Comparison$GCAM_k,  fill = 'GCAM k'), alpha = 0.5) +
xlab('k (y^-1)') + ylab('Count') +
scale_fill_manual(name = "Data Source", values = c('Experimental k' = '#45912c', 'GCAM k'='#e3962b')) +
theme_light() +
labs(title = 'SOC k value comparison during land use transition')
t.test(Rate_Comparison$Exp_k, Rate_Comparison$GCAM_k, alternative = 'two.sided') ->k_T_test
k_T_test
#Plot the two k vals against each other with a 1:1 line as well
ggplot(data = Full_Comparison, aes(x = Exp_k, y = GCAM_k)) +
geom_point(aes(shape = Final_Land_Use, color = Initial_Land_Use), size = 2) +
scale_shape_manual(values = c(4, 8, 16, 17)) +
scale_shape(solid = TRUE) +
geom_abline() +
xlab('Experimental k (1/y)') + ylab('GCAM Derived k (1/y)') +
theme_light() +
xlim(-.1, .4) + ylim(-.1, .4)  +
labs(title = 'SOC k comparison during land use transition', color =  'Initial Land Use', shape = 'Final Land Use')
source("C:/Users/bian240/OneDrive - PNNL/Desktop/Initial Project Code/GCAM-SoilC-Dynamics/Full_Analysis.R")
source("C:/Users/bian240/OneDrive - PNNL/Desktop/Initial Project Code/GCAM-SoilC-Dynamics/Full_Analysis.R")
#Plot the two k vals against each other with a 1:1 line as well
ggplot(data = Full_Comparison, aes(x = Exp_k, y = GCAM_k)) +
geom_point(aes(shape = Final_Land_Use, color = Initial_Land_Use), size = 2) +
scale_shape_manual(values = c(4, 8, 16, 17)) +
scale_shape(solid = TRUE) +
geom_abline() +
xlab('Experimental k (1/y)') + ylab('GCAM Derived k (1/y)') +
theme_light() +
xlim(-.1, .4) + ylim(-.1, .4)  +
labs(title = 'SOC k comparison during land use transition', color =  'Initial Land Use', shape = 'Final Land Use')
#Plot overlapping k histograms for the different k sources
ggplot() +
geom_histogram(aes(x = Full_Comparison$Exp_k,fill ='Experimental k'), alpha = 0.5) +
geom_histogram(aes(x = Full_Comparison$GCAM_k,  fill = 'GCAM k'), alpha = 0.5) +
xlab('k (y^-1)') + ylab('Count') +
scale_fill_manual(name = "Data Source", values = c('Experimental k' = '#45912c', 'GCAM k'='#e3962b')) +
theme_light() +
labs(title = 'SOC k value comparison during land use transition')
t.test(Full_Comparison$Exp_k, Full_Comparison$GCAM_k, alternative = 'two.sided')
source("C:/Users/bian240/OneDrive - PNNL/Desktop/Initial Project Code/GCAM-SoilC-Dynamics/Meta_Analysis.R")
Wei_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_Rate), sd_control= sd(Exp_Rate), n_control = n(),
mean_GCAM = mean(GCAM_Rate), sd_GCAM = sd(GCAM_Rate), n_GCAM = n()
) -> Wei_MA_data
Wei_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_k), sd_control= sd(Exp_k), n_control = n(),
mean_GCAM = mean(GCAM_k), sd_GCAM = sd(GCAM_k), n_GCAM = n()
) -> Wei_MA_data
#Now, we can use escalc to get the standardized mean difference
Wei_effect_sizes <-
escalc('SMD',
m1i = mean_control, n1i = n_control, sd1i = sd_control,
m2i = mean_GCAM, n2i = n_GCAM, sd2i = sd_GCAM,
data = Wei_MA_data
)
#We're going to use a fixed effect model for this analysis, which we set up below
Wei_fixed_effect_results <- rma(yi, vi, method = 'FE',
slab = GLU_code,
data = Wei_effect_sizes)
Wei_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_k), sd_control= sd(Exp_k), n_control = n(),
mean_GCAM = mean(GCAM_k), sd_GCAM = sd(GCAM_k), n_GCAM = n()
)
escalc('SMD',
m1i = mean_control, n1i = n_control, sd1i = sd_control,
m2i = mean_GCAM, n2i = n_GCAM, sd2i = sd_GCAM,
data = Wei_MA_data
)
rma(yi, vi, method = 'FE',
slab = GLU_code,
data = Wei_effect_sizes)
forest(
Wei_effect_sizes$yi, Wei_effect_sizes$vi,
annotate = FALSE,
slab = Wei_fixed_effect_results$slab,
xlab = 'ln(Response Ratio)',
#Below sets the size of study labels, shape of bars, and size of x labels
cex = .8, pch = 15, cex.lab = 1
)
#Creating the Wei et al comparison data
Wei %>%
select(Initial_Land_Use, Final_Land_Use, GLU_code, GCAM_region_ID, OC_decrease, Time) %>%
na.omit() %>%
mutate(Land_Type = Initial_Land_Use) %>%
right_join(simple_soilC_regions, by = c('GLU_code', 'Land_Type', 'GCAM_region_ID')) %>%
rename(initial_soil_c = soil_c) %>%
select(-Land_Type) %>%
mutate(Land_Type = Final_Land_Use) %>%
right_join(simple_soilC_regions, by = c('GLU_code', 'Land_Type', 'GCAM_region_ID')) %>%
rename(final_soil_c = soil_c) %>%
select(-Land_Type, -soilTimeScale.x) %>%
rename(soilTimeScale = soilTimeScale.y) %>%
na.omit() %>%
mutate(GCAM_Rate = (final_soil_c - initial_soil_c)/soilTimeScale,
GCAM_k = -log(final_soil_c/initial_soil_c)/Time,
Exp_k = -log(1/((abs(OC_decrease)/100) +1))/Time,
source = 'Wei et al'
) %>%
#This next line corrects the sign of Exp_k--we had to take the absolute value to avoid NaNs, so this accounts for that
mutate(Exp_k = ifelse(sign(Exp_k) == sign(OC_decrease), Exp_k, Exp_k*(-1))) -> Wei_Comparison
Full_Comparison <- bind_rows(
select(PostKwon_Comparison, -Exp_Rate, -Rate_Difference),
select(Wei_Comparison, -OC_decrease)
)
Full_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_k), sd_control= sd(Exp_k), n_control = n(),
mean_GCAM = mean(GCAM_k), sd_GCAM = sd(GCAM_k), n_GCAM = n()
)
Full_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_k), sd_control= sd(Exp_k), n_control = n(),
mean_GCAM = mean(GCAM_k), sd_GCAM = sd(GCAM_k), n_GCAM = n()
) -> Full_MA_data
escalc('SMD',
m1i = mean_control, n1i = n_control, sd1i = sd_control,
m2i = mean_GCAM, n2i = n_GCAM, sd2i = sd_GCAM,
data = Full_MA_data
)
Full_effect_sizes <-
escalc('SMD',
m1i = mean_control, n1i = n_control, sd1i = sd_control,
m2i = mean_GCAM, n2i = n_GCAM, sd2i = sd_GCAM,
data = Full_MA_data
)
rma(yi, vi, method = 'FE',
slab = GLU_code,
data = Full_effect_sizes)
Full_fixed_effect_results <- rma(yi, vi, method = 'FE',
slab = GLU_code,
data = Full_effect_sizes)
forest(
Full_effect_sizes$yi, Full_effect_sizes$vi,
annotate = FALSE,
slab = Full_fixed_effect_results$slab,
xlab = 'ln(Response Ratio)',
#Below sets the size of study labels, shape of bars, and size of x labels
cex = .8, pch = 15, cex.lab = 1
)
forest(
Full_effect_sizes$yi, Full_effect_sizes$vi,
annotate = TRUE,
slab = Full_fixed_effect_results$slab,
xlab = 'ln(Response Ratio)',
#Below sets the size of study labels, shape of bars, and size of x labels
cex = .8, pch = 15, cex.lab = 1
)
#Adding the summary effect size
addpoly(
Full_fixed_effect_results,
col = 'orange', cex = 1, annotate = TRUE, mlab = 'Summary'
)
PostKwon_fixed_effect_results
Wei_fixed_effect_results
Full_fixed_effect_results
PostKwon_Comparison %>%
group_by(GLU_code) %>%
summarize(mean_control = mean(Exp_k), sd_control= sd(Exp_k), n_control = n(),
mean_GCAM = mean(GCAM_k), sd_GCAM = sd(GCAM_k), n_GCAM = n()
) -> PostKwon_MA_k_data
#Now, we can use escalc to get the standardized mean difference
PostKwon_k_effect_sizes <-
escalc('SMD',
m1i = mean_control, n1i = n_control, sd1i = sd_control,
m2i = mean_GCAM, n2i = n_GCAM, sd2i = sd_GCAM,
data = PostKwon_MA_k_data
)
#We're going to use a fixed effect model for this analysis, which we set up below
PostKwon_k_fixed_effect_results <- rma(yi, vi, method = 'FE',
slab = GLU_code,
data = PostKwon_k_effect_sizes)
PostKwon_k_fixed_effect_results
#Forest plot for Post & Kwon k vals
forest(
PostKwon_k_effect_sizes$yi, PostKwon_k_effect_sizes$vi,
annotate = FALSE,
slab = PostKwon_k_fixed_effect_results$slab,
xlab = 'ln(Response Ratio)',
#Below sets the size of study labels, shape of bars, and size of x labels
cex = .8, pch = 15, cex.lab = 1
)
#Adding the summary effect size
addpoly(
PostKwon_k_fixed_effect_results,
col = 'orange', cex = 1, annotate = TRUE, mlab = 'Summary'
)
Full_fixed_effect_results
#Forest plot for full dataset
forest(
Full_effect_sizes$yi, Full_effect_sizes$vi,
annotate = TRUE,
slab = Full_fixed_effect_results$slab,
xlab = 'ln(Response Ratio)',
#Below sets the size of study labels, shape of bars, and size of x labels
cex = .8, pch = 15, cex.lab = 1
)
Full_fixed_effect_results
